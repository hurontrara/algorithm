-- 코드를 입력하세요
# 세단 또는 SUV / 2022-11-01 ~ 2022-11-30까지 대여 가능 / 30일간 50만 ~ 200만]
# 2번에 없고, 

SELECT A.CAR_ID, A.CAR_TYPE, ROUND(A.DAILY_FEE * 30 * (1 - C.DISCOUNT * .01), 0) AS FEE
FROM CAR_RENTAL_COMPANY_CAR A JOIN (
    SELECT CAR_TYPE, MAX(CONVERT(REPLACE(DISCOUNT_RATE, '%', ''), SIGNED)) AS DISCOUNT
    FROM CAR_RENTAL_COMPANY_DISCOUNT_PLAN
    WHERE DURATION_TYPE <> '90일 이상'
    GROUP BY CAR_TYPE) C ON A.CAR_TYPE = C.CAR_TYPE
WHERE A.CAR_ID NOT IN (SELECT DISTINCT(CAR_ID)
                        FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
                        WHERE (START_DATE BETWEEN '2022-11-01' AND '2022-11-30') 
                        OR (END_DATE BETWEEN '2022-11-02' AND '2022-11-30')
                        OR (START_DATE < '2022-11-01' AND END_DATE > '2022-11-30')
                      )
AND (A.DAILY_FEE * 30 * (1 - C.DISCOUNT * .01)) BETWEEN 500000 AND 2000000 - 1
ORDER BY FEE DESC, CAR_TYPE, CAR_ID DESC


